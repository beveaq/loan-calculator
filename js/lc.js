$(document).ready(function(){var f=false;var m=$("form#loan-calc");var l=$("div#loan-table table");var j=l.find("th").length-1;var i=$("th");var g=$("button#loancalc-download-csv");var b=$("button#text-file");var k=$("label.radio-button");var h=50;var a=1000000;if(l.find("tbody tr").length==0){l.css("display","none")}var e=function(){$("input#label").val('"Loan";');$("input#loan-amount").val("5000");$("input#interest-rate").val("9.9");var n=2*$("input#loan-amount").val()*($("input#interest-rate").val()/100);$("input#each-payment").val("160.11");$("input#months").val("12");$("input#years").val("0")};if(f){e()}$.getJSON("quotes.json",function(p){var o=p[Math.floor(Math.random()*p.length)];var n="<blockquote><p>&ldquo;"+o.t+"&rdquo;</p>";if(o.a!=""){n+="<footer>"+o.a+"</footer>"}n+="</blockquote>";$("div#quotes").append(n)});function d(p,o){if(isNaN(p)||p==0){if(f){e()}o.show();return false}else{o.hide();return true}}function c(p,q,o){var n=p;l.find("th").each(function(){if($(this).text()!=""){if(o){n+='"'+$(this).text()+'"'+q}else{n+=$(this).text()+q}}});n=n.replace(/[▲▼]/g,"");l.find("tr").each(function(r){$(this).find("td").each(function(s){if(s!=j){if((s==0)||(s==3)){if(o){n+='"'+$(this).text()+'"'+q}else{n+=$(this).text()+q}}else{n+=$(this).text()+q}}});n=n.slice(0,-1);n+="\n"});return n}k.on("click",function(){if($(this).attr("id")=="select-monthly-payments"){$("label#select-payment-period").removeAttr("disabled");$("label#select-monthly-payments").attr("disabled",true);$("div#payment-period").hide();$("div#monthly-payment").show()}else{if($(this).attr("id")=="select-payment-period"){$("label#select-monthly-payments").removeAttr("disabled");$("label#select-payment-period").attr("disabled",true);$("div#monthly-payment").hide();$("div#payment-period").show()}}});$("button#add-loan").click(function(n){n.preventDefault();var v=$("input#label").val();v=v.replace(/[";]/g,"");if(v==""){v="Loan "}var s=sanitise_money($("input#loan-amount").val());var u=sanitise_float_int($("input#interest-rate").val());var p=sanitise_int($("input#months").val());var t=sanitise_int($("input#years").val());var w=sanitise_money($("input#each-payment").val());$("input#label").val(v);if(!isNaN(s)){$("input#loan-amount").val(s)}if(!isNaN(u)){$("input#interest-rate").val(u)}if(!isNaN(p)){$("input#months").val(p)}if(!isNaN(t)){$("input#years").val(t)}if(!isNaN(w)){$("input#each-payment").val(w)}if($("label#select-monthly-payments").hasClass("active")){p=null;t=null}else{if($("label#select-payment-period").hasClass("active")){w=null}}if(!d(s,$("div#loan-amount-invalid"))){return false}if(!d(u,$("div#interest-invalid"))){return false}if(p!==null){if(isNaN(p)&&isNaN(t)){if(f){e()}$("div#payment-period-invalid").show();return false}else{$("div#payment-period-invalid").hide()}}if(w!==null){if(!d(w,$("div#each-payment-invalid"))){return false}if(w>s){$("div#each-payment-too-high").show();return false}else{$("div#each-payment-too-high").hide()}if(w<s*u/100/12){$("div#each-payment-too-low").show();return false}else{$("div#each-payment-too-low").hide()}}if(s<=h){$("div#low-loan-amount").show()}else{$("div#low-loan-amount").hide()}var r=0;l.find("tr").each(function(y){var A=$(this).find("td").eq(0).text();var z=A.split(" ");var x=parseInt(z.slice(-1)[0]);z.pop();if(v==z.join(" ")){if(x>r){r=x}}});v+=" "+(r+1);var o=calc_loan(s,u,p,t,w);if(w===null){w=o.payment_per_month}o.months=Math.ceil(o.months);var q=new Date();q.setMonth(q.getMonth()+o.months);q=q.toString().split(" ");l.find("tbody").append('<tr class="loan"><td>'+v+"</td><td>"+s+"</td><td>"+u+"</td><td>"+o.months+" ("+q[1]+" '"+q[3].slice(2,4)+")</td><td>"+w.toFixed(2)+"</td><td>"+o.total.toFixed(2)+"</td><td>"+o.total_interest.toFixed(2)+'</td><td class="erase"><button class="remove-row btn-danger round" title="Delete row">x</button></td></tr>');l.show();g.attr("disabled",false);b.attr("disabled",false)});l.on("click","button",function(n){$(this).parent().parent().remove();if(l.find("tbody tr").length==0){l.hide();g.attr("disabled",true);b.attr("disabled",true)}});i.click(function(){sort_column($(this))});$("button#clear").click(function(){$("input#label").val("");$("input#loan-amount").val("");$("input#interest-rate").val("");$("input#each-payment").val("");$("input#months").val("");$("input#years").val("")});$("button#reload").click(function(){location.reload(true)});b.click(function(){var n=c("","    ",false);console.log(n);if(navigator.appVersion.toString().indexOf(".NET")>0){var o=new Blob([n],{type:"text/plain;charset=utf-8"});window.navigator.msSaveBlob(o,"loans.txt");return true}var p=function(v,u){var t=document.createElement("a");t.id="download_link";document.body.appendChild(t);window.URL=window.URL||window.webkitURL;var r="\ufeff"+u,q="data:attachment/plain;charset=utf-8,"+encodeURIComponent(u),s=v;$("#download_link").attr({download:s,href:q});$("#download_link")[0].click();document.body.removeChild(t)};p("loans.txt",n)});g.click(function(){var o=c("data:text/csv;charset=utf-8,",";",true);if(navigator.appVersion.toString().indexOf(".NET")>0){var n=new Blob([text_content],{type:"text/plain;charset=utf-8"});window.navigator.msSaveBlob(n,"loans.txt");return true}var q=document.createElement("a");var p=encodeURI(o);q.href=p;q.download="loans.csv";document.body.appendChild(q);q.click();document.body.removeChild(q)})});var calc_loan=function(j,k,a,h,f){var c=k/100/12;var b=0;var m=new Array();var d=j;if(f!==null){var e=f;var b=Math.log(e/(e-j*c))/Math.log(1+c);m.months=b;m.total=0;var l=true;var g=0;while(l){var o=e-c*j;if(o>j){m.total+=c*j+j;l=false}else{m.total+=e;j-=o;g+=1}}}else{h=defaultVal(h,0);if(isNaN(a)){a=0}if(isNaN(h)){h=0}b=a;if(h>0){b+=h*12}e=j*c*Math.pow(1+c,b)/(Math.pow(1+c,b)-1);m.months=b;m.total=0;for(var c=0;c<b;c++){mi=c*j;prin=e-mi;m.total+=e;j-=prin}m.payment_per_month=e}m.total_interest=m.total-d;return m};function sanitise_money(a){a=a.replace(/[^0-9.]+/g,"");return parseFloat(a)}function sanitise_float_int(a){a=parseFloat(a);if(!isNaN(a)){return a}return NaN}function sanitise_int(a){return parseInt(a)}function sort_column(c,a,b){var b=b||"";var f=c.parents("table").eq(0);var g=f.find("tbody tr");var e=g.toArray().sort(_comparer(c.index(),b));this.asc=!this.asc;if(typeof(a)==="boolean"){this.asc=a}if(!this.asc){e=e.reverse()}for(var d=0;d<e.length;d++){f.append(e[d])}if(this.asc){c.find("span.sort-icon").html("&#9650;")}else{c.find("span.sort-icon").html("&#9660;")}}function _comparer(b,a){var a=a||"";return function(e,c){var f=_getCellValue(e,b,a);var d=_getCellValue(c,b,a);return $.isNumeric(f)&&$.isNumeric(d)?f-d:f.localeCompare(d)}}function _getCellValue(c,b,a){var a=a||"";return $(c).children("td").eq(b).text()}function defaultVal(a,b){return typeof a!=="undefined"?a:b}function starts_with(b,a){return b.lastIndexOf(a,0)===0};